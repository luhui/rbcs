# RBCS性能测试方案

### 一、性能测试目标

- 评估系统在不同负载下的性能表现，包括但不限于响应时间、吞吐量、资源利用率等指标。
- 找出系统的性能瓶颈，为优化系统性能提供依据。
- 确保系统在高并发场景下满足业务需求，如在一定的并发用户数和请求频率下，系统的关键业务功能能够正常运行。

### 二、性能测试工具

- 使用wrk，轻量易用

### 三、测试场景和测试用例

### （一）账户管理性能测试

### 1. 创建账户（CREATE_ACCOUNT）

- **测试用例描述**：模拟大量并发用户同时发起创建账户请求。
- **测试步骤**：
    1. 设置不同的并发用户数（如 100、500、1000）和请求频率。
    2. 每个请求携带账户相关信息，如随机生成的账户号、初始余额、账户类型等。
    3. 发送创建账户请求到业务系统。
    4. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 2. 查询账户（QUERY_ACCOUNT）

- **测试用例描述**：模拟大量并发用户同时发起查询账户请求。
- **测试步骤**：
    1. 先使用创建账户测试用例创建一定数量的账户，以便有足够的数据进行查询。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带账户号或其他唯一标识，随机选择已创建的账户进行查询。
    4. 发送查询账户请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 3. 冻结账户（FREEZE_ACCOUNT）

- **测试用例描述**：模拟管理员用户并发发起冻结账户请求。
- **测试用例步骤**：
    1. 确保有足够的账户处于激活状态。
    2. 设置不同的并发管理员用户数和请求频率。
    3. 每个请求携带要冻结的账户号。
    4. 发送冻结账户请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 4. 激活账户（ACTIVE_ACCOUNT）

- **测试用例描述**：模拟并发用户发起激活账户请求。
- **测试用例步骤**：
    1. 确保有足够的账户处于冻结状态。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带要激活的账户号。
    4. 发送激活账户请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### （二）交易处理性能测试

### 1. 发起交易（CREATE_TRANSACTION）

- **测试用例描述**：模拟大量并发用户同时发起交易请求，包括存款、取款和转账。
- **测试用例步骤**：
    1. 确保有足够的账户处于激活状态，且账户余额满足交易需求。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带交易信息，包括交易类型（存款、取款、转账）、交易金额、源账户和目标账户等。
    4. 发送发起交易请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 2. 查询交易（QUERY_TRANSACTION）

- **测试用例描述**：模拟大量并发用户同时发起查询交易请求。
- **测试用例步骤**：
    1. 先使用发起交易测试用例生成一定数量的交易记录。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带交易ID或其他筛选条件，随机选择已创建的交易进行查询。
    4. 发送查询交易请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 3. 存款（C1）

- **测试用例描述**：模拟大量并发用户同时发起存款请求。
- **测试用例步骤**：
    1. 确保有足够的账户处于激活状态。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带存款账户和存款金额。
    4. 发送存款请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 4. 取款（C2）

- **测试用例描述**：模拟大量并发用户同时发起取款请求。
- **测试用例步骤**：
    1. 确保有足够的账户处于激活状态且有足够的余额。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带取款账户和取款金额。
    4. 发送取款请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 5. 转账（C3）

- **测试用例描述**：模拟大量并发用户同时发起转账请求。
- **测试用例步骤**：
    1. 确保有足够的账户处于激活状态且有足够的余额。
    2. 设置不同的并发用户数和请求频率。
    3. 每个请求携带源账户、目标账户和转账金额。
    4. 发送转账请求到业务系统。
    5. 收集性能指标，如平均响应时间、吞吐量、错误率等。

### 四、性能指标收集和分析

### （一）响应时间

- 收集每个请求的响应时间，计算平均响应时间、最小响应时间和最大响应时间。
- 观察响应时间随并发用户数增加的变化趋势，判断系统的性能瓶颈。

### （二）吞吐量

- 计算系统在单位时间内处理的请求数量（如每秒处理的请求数）。
- 观察吞吐量随并发用户数增加的变化，评估系统的处理能力。

### （三）资源利用率

- 监控服务器的 CPU 使用率、内存使用率、磁盘 I/O 和网络带宽等。
- 分析资源瓶颈是否与性能问题相关，如高 CPU 使用率可能导致响应时间增加。

### （四）错误率

- 统计测试过程中出现的错误请求数量，计算错误率。
- 分析错误的类型和原因，如超时错误、服务器内部错误等。

### 五、测试结果报告

- 生成详细的性能测试报告，包括测试环境、测试用例、性能指标数据、性能趋势图等。
- 根据测试结果，提出性能优化建议，如优化数据库查询、调整系统配置、增加服务器资源等。

### 六、性能测试注意事项

- 在测试前备份重要数据，以防测试过程中数据丢失或损坏。
- 逐渐增加并发用户数，避免一开始就对系统造成过大压力，以便观察系统性能的渐进变化。
- 进行多次测试，确保测试结果的稳定性和可靠性。